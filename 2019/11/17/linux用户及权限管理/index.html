<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <title>linux用户及权限管理 | 8315的博客</title>
  <meta name="keywords" content=" linux , 用户 ">
  <meta name="description" content="linux用户及权限管理 | 8315的博客">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="抱歉。。。您访问的网页找不到了。">
<meta name="keywords" content="学习|技术|快乐|每一天">
<meta property="og:type" content="website">
<meta property="og:title" content="404 网页未找到!">
<meta property="og:url" content="http://qzt8315.github.io/404.html">
<meta property="og:site_name" content="8315的博客">
<meta property="og:description" content="抱歉。。。您访问的网页找不到了。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-07-20T04:22:58.188Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="404 网页未找到!">
<meta name="twitter:description" content="抱歉。。。您访问的网页找不到了。">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value>
</div>

<body>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg">
</a>
<div class="author">
    <span>捌叁壹伍</span>
</div>

<div class="icon">
    
        
        <a title="rss" href="/atom.xml" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-rss"/>
                </svg>
            
        </a>
        
    
        
        <a title="github" href="https://github.com/qzt8315" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"/>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(28)</small></div></li>
    
        
            
            <li><div data-rel="学习"><i class="fold iconfont icon-right"></i>学习<small>(21)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="hexo">hexo<small>(4)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="linux">linux<small>(10)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="markdown">markdown<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="理论">理论<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="易企秀">易企秀<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="编程">编程<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="秀米">秀米<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="网络">网络<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="生活"><i class="fold iconfont icon-right"></i>生活<small>(2)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="计算机">计算机<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="观影">观影<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="读书"><i class="fold iconfont icon-right"></i>读书<small>(5)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="西瓜书">西瓜书<small>(5)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a style="border-right: 1px solid #fff; width: 49%" class="about site_url" href="/about">关于</a><a style="width: 50%" class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="28">
<input type="hidden" id="yelog_site_word_count" value="38.4k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://www.77ee.top/">个人网站</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="以 in: 开头进行全文搜索" autocomplete="off" id="local-search-input">
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none">
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">教程</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">博客</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">hexo</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">新手</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">公式编辑</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">awk</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">备份</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">设置</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">网卡</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">bond</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">用户</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">markdown</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">标签</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">语法</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">入门</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">quota</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">raid</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">lvm</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">shell-script</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">判断式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">PC</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">维护</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">命令</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">数学公式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">观影</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">动漫</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">H5</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">易企秀</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">diff</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">cmp</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">patch</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">正则表达式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">深度学习</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">概念</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">秀米</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">图文排版</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">网络</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">基础概念</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">shell_script</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">西瓜书</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">符号表</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">读书</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">第一章</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">第三章</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">第二章</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">第四章</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a class="学习 hexo " href="/2019/07/25/Hexo的一些插件/" data-tag="教程,博客,hexo,新手" data-author>
            <span class="post-title" title="Hexo的一些插件">Hexo的一些插件</span>
            <span class="post-date" title="2019-07-25 19:46:36">2019/07/25</span>
        </a>
        
        <a class="学习 hexo " href="/2019/07/22/Hexo结合MathJax编辑公式/" data-tag="教程,博客,hexo,新手,公式编辑" data-author>
            <span class="post-title" title="Hexo结合MathJax编辑公式">Hexo结合MathJax编辑公式</span>
            <span class="post-date" title="2019-07-22 17:28:42">2019/07/22</span>
        </a>
        
        <a class="学习 linux " href="/2019/10/18/awk工具/" data-tag="linux,awk" data-author>
            <span class="post-title" title="awk工具">awk工具</span>
            <span class="post-date" title="2019-10-18 00:47:46">2019/10/18</span>
        </a>
        
        <a class="学习 hexo " href="/2019/07/21/git实现博客和主题的备份和同步/" data-tag="教程,博客,hexo,备份" data-author>
            <span class="post-title" title="Git实现博客和主题的备份和同步">Git实现博客和主题的备份和同步</span>
            <span class="post-date" title="2019-07-21 12:32:49">2019/07/21</span>
        </a>
        
        <a class="学习 hexo " href="/2019/07/21/hexo-github-pages开启你的个人博客/" data-tag="教程,博客,hexo,新手" data-author>
            <span class="post-title" title="Hexo+Github Pages开启你的个人博客">Hexo+Github Pages开启你的个人博客</span>
            <span class="post-date" title="2019-07-21 21:53:03">2019/07/21</span>
        </a>
        
        <a class="学习 linux " href="/2019/08/25/linux中设置网卡bond/" data-tag="linux,设置,网卡,bond" data-author>
            <span class="post-title" title="linux中设置网卡bond">linux中设置网卡bond</span>
            <span class="post-date" title="2019-08-25 01:37:32">2019/08/25</span>
        </a>
        
        <a class="学习 linux " href="/2019/11/17/linux用户及权限管理/" data-tag="linux,用户" data-author>
            <span class="post-title" title="linux用户及权限管理">linux用户及权限管理</span>
            <span class="post-date" title="2019-11-17 11:58:41">2019/11/17</span>
        </a>
        
        <a class="学习 markdown " href="/2019/07/18/markdown入门/" data-tag="markdown,标签,语法,入门" data-author>
            <span class="post-title" title="Markdown入门">Markdown入门</span>
            <span class="post-date" title="2019-07-18 16:45:51">2019/07/18</span>
        </a>
        
        <a class="学习 linux " href="/2019/12/18/quota-raid和lvm/" data-tag="quota,raid,lvm" data-author>
            <span class="post-title" title="quota,raid和lvm">quota,raid和lvm</span>
            <span class="post-date" title="2019-12-18 16:39:25">2019/12/18</span>
        </a>
        
        <a class="学习 linux " href="/2019/10/08/sed工具/" data-tag="linux,入门" data-author>
            <span class="post-title" title="sed工具">sed工具</span>
            <span class="post-date" title="2019-10-08 16:35:40">2019/10/08</span>
        </a>
        
        <a class="学习 linux " href="/2019/11/11/shell-script/" data-tag="linux,shell-script" data-author>
            <span class="post-title" title="shell script">shell script</span>
            <span class="post-date" title="2019-11-11 16:11:51">2019/11/11</span>
        </a>
        
        <a class="学习 linux " href="/2019/11/14/shell中的判断式/" data-tag="linux,判断式" data-author>
            <span class="post-title" title="shell中的判断式">shell中的判断式</span>
            <span class="post-date" title="2019-11-14 20:21:57">2019/11/14</span>
        </a>
        
        <a class="生活 计算机 " href="/2019/10/31/华硕飞行堡垒fx50j加固态、清灰及更换硅脂过程/" data-tag="PC,维护" data-author>
            <span class="post-title" title="华硕飞行堡垒fx50j加固态、清灰及更换硅脂过程">华硕飞行堡垒fx50j加固态、清灰及更换硅脂过程</span>
            <span class="post-date" title="2019-10-31 20:27:17">2019/10/31</span>
        </a>
        
        <a class="学习 linux " href="/2019/11/12/常用linux命令列表/" data-tag="linux,命令" data-author>
            <span class="post-title" title="常用linux命令列表">常用linux命令列表</span>
            <span class="post-date" title="2019-11-12 16:36:02">2019/11/12</span>
        </a>
        
        <a class="学习 理论 " href="/2020/02/04/常用的数学公式/" data-tag="数学公式" data-author>
            <span class="post-title" title="常用的数学公式">常用的数学公式</span>
            <span class="post-date" title="2020-02-04 18:13:14">2020/02/04</span>
        </a>
        
        <a class="生活 观影 " href="/2019/07/29/成年人看的动漫-《哪吒之魔童降世》/" data-tag="观影,动漫" data-author>
            <span class="post-title" title="成年人看的动漫-《哪吒之魔童降世》">成年人看的动漫-《哪吒之魔童降世》</span>
            <span class="post-date" title="2019-07-29 11:27:23">2019/07/29</span>
        </a>
        
        <a class="学习 易企秀 " href="/2019/08/17/易企秀使用学习教程/" data-tag="教程,H5,易企秀" data-author>
            <span class="post-title" title="易企秀使用学习教程">易企秀使用学习教程</span>
            <span class="post-date" title="2019-08-17 14:14:40">2019/08/17</span>
        </a>
        
        <a class="学习 linux " href="/2019/10/30/档案对比工具/" data-tag="linux,diff,cmp,patch" data-author>
            <span class="post-title" title="档案对比工具">档案对比工具</span>
            <span class="post-date" title="2019-10-30 17:48:26">2019/10/30</span>
        </a>
        
        <a class="学习 编程 " href="/2019/10/05/正则表达式/" data-tag="正则表达式" data-author>
            <span class="post-title" title="正则表达式">正则表达式</span>
            <span class="post-date" title="2019-10-05 23:53:31">2019/10/05</span>
        </a>
        
        <a class="学习 " href="/2019/09/03/深度学习中一些概念的东西/" data-tag="深度学习,概念" data-author>
            <span class="post-title" title="深度学习中一些概念的东西">深度学习中一些概念的东西</span>
            <span class="post-date" title="2019-09-03 14:25:02">2019/09/03</span>
        </a>
        
        <a class="学习 秀米 " href="/2019/08/18/秀米使用学习教程/" data-tag="教程,H5,秀米,图文排版" data-author>
            <span class="post-title" title="秀米使用学习教程">秀米使用学习教程</span>
            <span class="post-date" title="2019-08-18 13:36:50">2019/08/18</span>
        </a>
        
        <a class="学习 网络 " href="/2019/08/21/网络基本概念/" data-tag="网络,基础概念" data-author>
            <span class="post-title" title="网络基本概念">网络基本概念</span>
            <span class="post-date" title="2019-08-21 19:04:18">2019/08/21</span>
        </a>
        
        <a class="学习 linux " href="/2019/11/15/自编shell命令/" data-tag="shell_script" data-author>
            <span class="post-title" title="自编shell命令">自编shell命令</span>
            <span class="post-date" title="2019-11-15 00:30:03">2019/11/15</span>
        </a>
        
        <a class="读书 西瓜书 " href="/2019/07/22/西瓜书-符号表/" data-tag="西瓜书,符号表,读书" data-author>
            <span class="post-title" title="西瓜书_符号表">西瓜书_符号表</span>
            <span class="post-date" title="2019-07-22 16:10:25">2019/07/22</span>
        </a>
        
        <a class="读书 西瓜书 " href="/2019/07/19/西瓜书-第一章/" data-tag="西瓜书,读书,第一章" data-author>
            <span class="post-title" title="西瓜书_第一章">西瓜书_第一章</span>
            <span class="post-date" title="2019-07-19 21:19:43">2019/07/19</span>
        </a>
        
        <a class="读书 西瓜书 " href="/2019/07/29/西瓜书-第三章/" data-tag="西瓜书,读书,第三章" data-author>
            <span class="post-title" title="西瓜书_第三章">西瓜书_第三章</span>
            <span class="post-date" title="2019-07-29 14:43:42">2019/07/29</span>
        </a>
        
        <a class="读书 西瓜书 " href="/2019/07/23/西瓜书-第二章/" data-tag="西瓜书,读书,第二章" data-author>
            <span class="post-title" title="西瓜书_第二章">西瓜书_第二章</span>
            <span class="post-date" title="2019-07-23 16:26:23">2019/07/23</span>
        </a>
        
        <a class="读书 西瓜书 " href="/2019/08/30/西瓜书-第四章/" data-tag="西瓜书,读书,第四章" data-author>
            <span class="post-title" title="西瓜书_第四章">西瓜书_第四章</span>
            <span class="post-date" title="2019-08-30 14:54:48">2019/08/30</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-linux用户及权限管理" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">linux用户及权限管理</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a href="javascript:" data-rel="学习">学习</a>/
            
                <a href="javascript:" data-rel="linux">linux</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color1">linux</a>
            
            <a href="javascript:" class="color3">用户</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title="更新时间: 2019-12-18 14:11:07">2019-11-17 11:58</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:9.4k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用户"><span class="toc-text">用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用户和用户组"><span class="toc-text">用户和用户组</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UID"><span class="toc-text">UID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用户密码"><span class="toc-text">用户密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GID"><span class="toc-text">GID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用户组密码"><span class="toc-text">用户组密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#有效用户组和初始用户组"><span class="toc-text">有效用户组和初始用户组</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#查看自己所属的用户组"><span class="toc-text">查看自己所属的用户组</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#切换有效群组"><span class="toc-text">切换有效群组</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用户管理"><span class="toc-text">用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#新增"><span class="toc-text">新增</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#useradd"><span class="toc-text">useradd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#passwd"><span class="toc-text">passwd</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改"><span class="toc-text">修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#chage"><span class="toc-text">chage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#usermod"><span class="toc-text">usermod</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除"><span class="toc-text">删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#userdel"><span class="toc-text">userdel</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用户自查"><span class="toc-text">用户自查</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#id"><span class="toc-text">id</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACL权限"><span class="toc-text">ACL权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#开启分区ACL权限"><span class="toc-text">开启分区ACL权限</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#临时开启分区ACL权限"><span class="toc-text">临时开启分区ACL权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#永久开启分区ACL权限"><span class="toc-text">永久开启分区ACL权限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACL权限设置"><span class="toc-text">ACL权限设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#setfacl"><span class="toc-text">setfacl</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#例子"><span class="toc-text">例子</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getfacl"><span class="toc-text">getfacl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#有效掩码"><span class="toc-text">有效掩码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#预设ACL权限"><span class="toc-text">预设ACL权限</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#例子-1"><span class="toc-text">例子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用户身份切换"><span class="toc-text">用户身份切换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#切换身份的原因"><span class="toc-text">切换身份的原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#一般用户切换为root用户方法"><span class="toc-text">一般用户切换为root用户方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#su"><span class="toc-text">su</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sudo"><span class="toc-text">sudo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sudo设置"><span class="toc-text">sudo设置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#visudo和-etc-sudoers"><span class="toc-text">visudo和/etc/sudoers</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#有限制的指令操作"><span class="toc-text">有限制的指令操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#通过别名建置visudo"><span class="toc-text">通过别名建置visudo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sudo时间间隔"><span class="toc-text">sudo时间间隔</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#通过sudo将用户切换到root用户-非信任用户切勿使用"><span class="toc-text">通过sudo将用户切换到root用户(非信任用户切勿使用)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#特殊的SHELL"><span class="toc-text">特殊的SHELL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PAM模组"><span class="toc-text">PAM模组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PAM模块设定语法"><span class="toc-text">PAM模块设定语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#验证类别-type"><span class="toc-text">验证类别(type)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#控制标识（control-flag"><span class="toc-text">控制标识（control flag)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常用的PAM模块"><span class="toc-text">常用的PAM模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#limits-conf"><span class="toc-text">limits.conf</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用者的信息传递"><span class="toc-text">使用者的信息传递</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查询使用者，w，who，last，lastlog"><span class="toc-text">查询使用者，w，who，last，lastlog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用者之间交流，write，mesg，wall"><span class="toc-text">使用者之间交流，write，mesg，wall</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用者的邮箱"><span class="toc-text">使用者的邮箱</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Centos下建立大量账号"><span class="toc-text">Centos下建立大量账号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一些用户相关的检查工具"><span class="toc-text">一些用户相关的检查工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pwck"><span class="toc-text">pwck</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwconv"><span class="toc-text">pwconv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwunconv"><span class="toc-text">pwunconv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chpasswd"><span class="toc-text">chpasswd</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#大量建置用户的办法-passwd-–stdin"><span class="toc-text">大量建置用户的办法(passwd –stdin)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>每次使用linux系统我们都需要登录，用户在登录过程中起到重要的作用。本篇博客主要讲解用户及其管理的相关内容。</p>
<h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><p>用户是使用linux的前提，只有经过了linux的用户认证才能正常使用系统。那么在系统内部是怎么实现这样的机制的。</p>
<h3 id="用户和用户组"><a href="#用户和用户组" class="headerlink" title="用户和用户组"></a>用户和用户组</h3><p>对于计算机而言，只会识别0和1构成的二进制，对文字识别较差，因此如果用一个数字来表示一个用户的话会比较方便。linux系统是一个多人多任务系统，仅仅只有单个的用户显然是不合理的，多个用户也可以存在某种关系，比如说共同开发一个项目，那么这些成员应该同时属于同一个工作组，共享某些资源，因此也存在组的概念。和用户一样，用户组组也是用唯一的数字标识的。用户用UID标识，用户组使用GID标识。</p>
<h4 id="UID"><a href="#UID" class="headerlink" title="UID"></a>UID</h4><p>人和计算机存在认知的差别，计算机只对数字敏感，人对文字敏感，因此在人们使用linux系统的时候通常都是通过用户的名称来进行操作的，而在系统内部都是转化为数字，因此需要在硬盘上记录下用户名和用户标识的对应关系。linux使用<code>/etc/passwd</code>来记录。</p>
<p><img src="/2019/11/17/linux用户及权限管理/img1.webp" alt="/etc/passwd文件内容"></p>
<p>打开这个文件，里边有非常多的内容，其中就能看到熟悉的root用户和登录使用的test用户，还有一些伪用户。这些伪用户是为了方便系统管理，满足相应的系统进程对文件属主的要求 ，删除之后可能会导致严重的系统问题，不能将其删除。</p>
<p>在passwd文件中每一行记录一个用户的资料，每一行有7栏分别用‘:’分隔，没有内容的栏位为空。分别表示：</p>
<pre><code>用户名:密码(一般为x,密码单独存储在/etc/shadow):用户标识码(UID):用户组标识码(GID):用户说明:家目录:登录成功后执行的命令</code></pre><p><strong>用户名</strong>：日常使用系统登录时所使用的名字。使用’用户名’+’密码’即可登录系统。</p>
<p><strong>密码</strong>:目前使用的linux一般都不会将密码直接存储在<code>/etc/passwd</code>文件中，考虑到安全问题一般会存放在<code>/etc/shadow</code>文件中。这个栏位一般为’x’或‘*’。</p>
<p><strong>用户标识</strong>:在linux系统内部是依靠用户标识(UID)来辨识用户的，每一个用户一般会有唯一一个UID(一般UID为0的可能有多个，都是系统管理员)。并且UID分配具有一定的规律，可以查看<code>/etc/login.defs</code>文件获知，规律如下表所示:</p>
<table>
<thead>
<tr>
<th align="center">UID范围</th>
<th align="center">用户</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">表示系统管理员，要让其他用户具有root权限，即把该用户的UID改为0即可。一般不建议有多个系统管理员</td>
</tr>
<tr>
<td align="center">1~999</td>
<td align="center">系统用户，也就是伪用户，是系统为了使用较小的权限启动某些服务，减少root用户使用。Centos7中伪用户的范围为‘1~999’（其他的一些系统可能是1~499），一般是安装软件或者服务的时候创建。普通用户一般从1000开始，最大已经可以到（2^32-1）。(需要注意的是:1~200是系统自建系统用户的范围，用户自建系统用户一般是201~999)</td>
</tr>
<tr>
<td align="center">1000~60000</td>
<td align="center">普通用户</td>
</tr>
</tbody></table>
<p><strong>用户组标识</strong>:用户组的标识数字。</p>
<p><strong>用户说明</strong>:对账户的意义进行说明。</p>
<p><strong>家目录</strong>:指定家目录地址。</p>
<p><strong>登录成功后执行的命令</strong>：一般指定登录之后使用的shell。</p>
<h4 id="用户密码"><a href="#用户密码" class="headerlink" title="用户密码"></a>用户密码</h4><p>上文中说到，在较新的系统里边，密码加密之后存放在<code>/etc/shadow</code>里边。用普通的用户是无法读取该文件的，因为文件的权限为所有人<strong>都不允许</strong>读写，因此需要通过<code>su -</code>切换到root用户之后读取该文件，强烈不建议修改该文件的权限，因为修改该文件权限可能会导致系统安全问题(如用户密码泄露)。</p>
<p><img src="/2019/11/17/linux用户及权限管理/img2.webp" alt="/etc/shadow文件内容"></p>
<p><code>/etc/shadow</code>文件结构与<code>/etc/passwd</code>类似，每一行记录一个用户内容，用’:’分隔为9个栏位，分别表示:</p>
<pre><code>用户名:密码密文:最近密码修改日期:密码不可修改天数:密码有效天数:密码失效前警告天数:密码失效后宽限天数:用户失效日期:保留</code></pre><p><strong>密码密文</strong>:用户对应的密码加密之后的密文。在前面加入’*’或者’!’可以暂时禁止用户登录。</p>
<p><strong>最近密码修改日期</strong>:最近一次修改密码的日期。</p>
<p><strong>密码不可修改天数</strong>:密码修改之后的指定天数内不能再次修改密码。</p>
<p><strong>密码有效天数</strong>:据上次密码修改之后指定天数后用户需要修改密码。</p>
<p><strong>密码失效前警告天数</strong>:在密码需要修改前指定天数开始警告用户修改密码。</p>
<p><strong>密码失效后宽限天数</strong>:在密码过期后的指定天数内还可以使用该密码（宽限修改密码时间）。</p>
<p><strong>用户失效日期</strong>:在密码失效日期之后账户将不能再次登录使用。</p>
<p><strong>保留</strong>:为未来新功能保留。</p>
<h4 id="GID"><a href="#GID" class="headerlink" title="GID"></a>GID</h4><p>GID就是用户组标志。而用户组的基本信息放在<code>/etc/group</code>文件中。该文件中的信息也是一个用户组占一行，用’:’分隔为4栏。</p>
<pre><code>用户组名称:用户组密码:GID:此用户组支援账户名称</code></pre><p><strong>用户组名称</strong>:该用户组的名称。</p>
<p><strong>用户组密码</strong>:该用户组的密码，一般是给用户组管理员设置密码。用户组的密码不会直接记录在该栏位，密文会记录在<code>/etc/gshadow</code>中，该栏位一般记录为’x’。</p>
<p><strong>GID</strong>:用户组的ID。</p>
<p><strong>此用户组支援账户名称</strong>:加入该用户组的用户名称。</p>
<h4 id="用户组密码"><a href="#用户组密码" class="headerlink" title="用户组密码"></a>用户组密码</h4><p>用户组是可以通过用户组管理员进行管理的，通常会给组的管理员设置密码，那么这些内容都是存放在<code>/etc/gshadow</code>文件中的。</p>
<p>和存放用户密码的文件相同，该文件只有root用户可以读取，因此在读取该文件内容前应该先转化为root用户。该文件也是一行保存一个用户组资料，用’:’分隔出4个栏位，分别表示:</p>
<pre><code>用户组名称:密码密文:组管理员:此用户组支援账户名称</code></pre><p><strong>用户组名称</strong>:用户组的名称，与<code>/etc/group</code>中的名称相对应。</p>
<p><strong>密码密文</strong>:该密码是用于组管理员进行组管理的。</p>
<p><strong>组管理员</strong>:该用户组的管理员，现在组管理员使用较少了，一般使用<code>sudo</code>一类的指令。</p>
<p><strong>此用户组支援账户名称</strong>:和<code>/etc/group</code>中的字段一样。</p>
<h4 id="有效用户组和初始用户组"><a href="#有效用户组和初始用户组" class="headerlink" title="有效用户组和初始用户组"></a>有效用户组和初始用户组</h4><p><strong>有效用户组</strong>:就是指在创建文件或者路径时填入的所属用户组。</p>
<p><strong>初始用户组</strong>:就是在登录用户之后即可获得该用户组权限的用户组。也就是<code>/etc/passwd</code>文件中记录的GID所对应的用户组。</p>
<h5 id="查看自己所属的用户组"><a href="#查看自己所属的用户组" class="headerlink" title="查看自己所属的用户组"></a>查看自己所属的用户组</h5><p>使用<code>groups</code>命令即可查看所属的用户组，排在第一位的用户组即为<strong>有效用户组</strong>。</p>
<h5 id="切换有效群组"><a href="#切换有效群组" class="headerlink" title="切换有效群组"></a>切换有效群组</h5><p>使用<code>newgrp group</code>即可在新的shell环境中将<strong>有效用户组</strong>切换为指定用户组，特别需要注意的是，由于是在新环境中切换的有效用户组，在使用结束后要使用<code>exit</code>退出环境。</p>
<h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><h3 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h3><p>新增用户主要是使用<code>useradd</code>和<code>passwd</code>两个指令。</p>
<h4 id="useradd"><a href="#useradd" class="headerlink" title="useradd"></a>useradd</h4><p>以下为<code>useradd</code>的使用:</p>
<pre><code>useradd [-u UID] [-g 初始用户组] [-G 附加用户组] [-mM] [-c 用户说明] [-d 家目录绝对地址] [-s shell] 用户名

解释:
-g 指定该参数之后，即不会创建与用户名同名的用户组；
-m 强制！要创建使用者的家目录(一般用户的预设值)；
-M 强制！不要创建使用者的家目录(系统用户的预设值)；
-c /etc/passwd中用户说明栏内容，可以随便填入信息，默认为空；
-d 指定新建用户的家目录，一定要使用绝对路径；
-s 这个就是登录成功后执行的命令，指定使用的shell；
-r 指定建立一个系统用户，UID属于系统用户范围，在当前使用的系统中范围为201~999，可通过文档/etc/login.defs查看；
-e 账户失效日期，日期指定格式&#39;YYYY-MM-DD&#39;；
-f 账户密码有效天数，-1表示永不用修改密码。

注意：系统一般会有默认的用户添加的设置，在使用&#39;useradd username&#39;命令之后，默认的设置一般为:创建一般用户,新建和用户名相同的用户组并且将此用户组作为该用户的初始用户组，默认没有附加用户组和用户说明，默认使用&#39;/home/username&#39;作为用户的家目录，使用bash作为默认shell。useradd的默认设置也可以通过&#39;useradd -D&#39;命令查看（其实就是/etc/default/useradd文件指定的）。默认操作的文件是:`/etc/passwd`、&#39;/etc/shadow&#39;、&#39;/etc/group&#39;和&#39;/home/username&#39;</code></pre><p><img src="/2019/11/17/linux用户及权限管理/img3.webp" alt="useradd命令默认设置,注意:useradd命令执行需要root权限，所以需要在root用户下执行才能查看。"></p>
<p>上图参数解释:<br><strong>GROUP=100</strong>表示的是在创建用户时使用的初始用户组的ID为100也就是<code>users</code>用户组，这个根据不同发行版而有不同的设置，总的来说就是两种用户组的机制不同。CentOS系统采用的是<strong>私有用户组机制</strong>:即在创建用户的时候会新建一个同名的用户作为该用户的初始用户组，且家目录的权限设置为700，除该路径的所有者外其他用户都不能使用该目录，使用这种机制不会考虑GROUP=100这个设定，较为安全。还有一种机制是<strong>公共用户组机制</strong>:即会参考GROUP=100这个设定，将<code>users</code>用户组作为新建用户的初始用户组。一般家目录预设的权限为:755，大家都可以分享家目录的内容。比如说:SuSE系统就是使用公共用户组策略。</p>
<p><strong>HOME=/home</strong>：这个参数指定的是创建家目录的基准目录。一般家目录与用户名同名。</p>
<p><strong>INACTIVE=-1</strong>：这个参数指定的是用户密码失效，0表示每次登录都要重新设定密码，-1表示密码永不失效，30表示设定的密码30天之后失效。</p>
<p><strong>EXPIRE</strong>:表示账户默认失效日期，为空的话表示账户永不失效。</p>
<p><strong>SHELL=/bin/bash</strong>:指定创建账户默认使用的SHELL。不允许用户登录系统则是使用<code>/bin/nologin</code></p>
<p><strong>SKEL=/etc/skel</strong>:表示新建家目录的参考基准目录，直接将目录中的内容拷贝到新目录中。<br><img src="/2019/11/17/linux用户及权限管理/img4.webp" alt="新建家目录基准目录"></p>
<p><strong>CREATE_MAIL_SPOOL=yes</strong>:该参数指定是否建立使用者的邮箱</p>
<p><strong>/etc/login.defs文件内容</strong></p>
<p><img src="/2019/11/17/linux用户及权限管理/img5.webp" alt="/etc/login.defs文件内容"></p>
<p>在文件中的参数大多数都有相应的解释，着重需要注意的几个参数就是：</p>
<pre><code class="bash">MAIL_DIR /var/spool/mail # 用户邮箱默认放置路径

PASS_MAX_DAYS 9999 # 密码需要变更的最长时间
PASS_MIN_DAYS 0    # 密码需要变更的最短时间
PASS_MIN_LEN 5     # 密码的最小长度，已被pam模组取代，该参数已经失效,PAM模块相关资料:https://www.cnblogs.com/kevingrace/p/8671964.html
PASS_WARN_AGE 7    # 密码失效前天数进行警告

UID_MIN 1000       # 一般用户的起始UID
UID_MAX 60000      # 一般用户最大UID
SYS_UID_MIN 201    # 系统用户的起始UID
SYS_UID_MAX 999    # 系统用户的最大UID
GID_MIN 1000       # 用户组起始GID
GID_MAX 60000      # 用户组最大GID
SYS_GID_MIN 201    # 系统用户组其实GID
SYS_GID_MAX 999    # 系统用户组最大GID

CREATE_HOME yes    # 在不指定-m/-M时，默认创不创建家目录。
UMASK 077          # 创建家目录时的umask，默认权限为700
USERGROUPS_ENAB yes# 使用userdel删除用户时，删除初始用户组
ENCRYPT_METHOD SHA512# 密码使用SHA512加密算法。</code></pre>
<p>所以使用useradd时默认会参考<code>/etc/default/useradd</code>、<code>/etc/login.defs</code>、<code>/etc/skel/*</code>这几个文件。</p>
<h4 id="passwd"><a href="#passwd" class="headerlink" title="passwd"></a>passwd</h4><p>以下为<code>passwd</code>命令的使用:</p>
<pre><code class="bash">passwd [--stdin] [username]  # 所有用户都可以通过这样的方式修改自己的密码，当不指定用户时，默认修改自己的账号密码
passwd [-l] [-u] [--stdin] [-S] [-n天数] [-x天数] [-w天数] [-i天数] 账户  # 只有root用户可用
# 参数及选项
# --stdin 可以透过来自前一个管线的资料
# -l lock的意思，会在/etc/shadow中的密码密文前加!,封锁该用户登录
# -u unlock的意思，解除用户的封锁
# -S 列出密码相关参数，即/etc/shadow档案中的大部分资料
# -n天数 不可修改密码天数
# -x天数 密码有效天数
# -w天数 密码失效前警告天数
# -l天数 用户账户失效天数
# -d 删除用户的密码</code></pre>
<p>例如如果要让<code>test1</code>用户7天修改一次密码的话，那么可以设置为:<code>passwd -x 7 test1</code>。</p>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><h4 id="chage"><a href="#chage" class="headerlink" title="chage"></a>chage</h4><p>chage用法:</p>
<pre><code class="bash">chage -[ldEImMW] 用户名
# 选项说明
# -l 列出该用户的详细密码参数
# -d 日期 设置/etc/passwd中修改密码的时间，一般是以1970年1月1日到想要日期的天数
# -E 日期 格式为YYYY-MM-DD，账户失效日期
# -I 天数 密码修改的宽限天数
# -m 天数 密码不可修改的天数
# -M 天数 密码有效天数
# -W 天数 密码失效前天数警告</code></pre>
<p>假如我们希望用户在登陆的时候设置新密码，就可以这样创建用户，<code>useradd username &amp;&amp; echo ‘username’ | passwd --stdin username &amp;&amp; chage -M 0 -d 0 username</code>创建用户之后登录需要重新设置密码才能使用账户。</p>
<p><img src="/2019/11/17/linux用户及权限管理/img6.webp" alt="创建一个在登录时必须要重设密码的账户"></p>
<h4 id="usermod"><a href="#usermod" class="headerlink" title="usermod"></a>usermod</h4><p>当使用<code>useradd</code>命令设置了错误的参数或者遗忘了设置某种参数时，可以使用<code>usermod</code>命令，微调用户的参数。</p>
<pre><code class="bash">usermod [-cdegGlsuLU] username
# 选项解释
# -c 修改用户说明；
# -m 将原家目录中的内容移到新家目录中，与-d一起使用；
# -d home_path 修改用户登录后的家目录；
# -e YYYYMMDD 指定用户账户失效日期；
# -f 天数 用户密码失效之后宽限日期；
# -g group 设置初始用户组；
# -a 添加附加用户组，只能与-G选项一起用；
# -G group[,group[,group[...]]] 设置账户所支援的群组；
# -l username 设置用户新的用户名；
# -u uid 设置用户的uid；
# -o 设置非唯一的uid，与-u选项一起使用；
# -p passwd 修改用户密码，不推荐这种方式修改密码，因为这种方式需要自己确保密码符合系统的密码策略；
# -s shell 指定账户使用的shell
# -L username 锁定用户账号
# -U username 解锁用户账号</code></pre>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><h4 id="userdel"><a href="#userdel" class="headerlink" title="userdel"></a>userdel</h4><p>在linux系统中，删除用户账号使用<code>userdel</code>命令，用法如下:</p>
<pre><code class="bash">userdel [-fr] username
# 参数解释
# -f 强制删除用户，即使用户处于在线状态。同时也会删除用户的家目录和mail spool;
# -r 删除账户的同时也删除家目录和mail spool.</code></pre>
<h3 id="用户自查"><a href="#用户自查" class="headerlink" title="用户自查"></a>用户自查</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p><code>id</code>命令用于查询用户的uid和gid。</p>
<pre><code class="bash">id [选项] user
# 选项解释
# -</code></pre>
<h2 id="ACL权限"><a href="#ACL权限" class="headerlink" title="ACL权限"></a>ACL权限</h2><p>在linux的传统权限管理分为三种身份:所有者、用户组和其他。在设置限制或者允许单个用户访问文件时，存在着限制。</p>
<p>ACL时Access Control Lists的缩写，是Unix-Like系统的额外支援项目，主要是提供相较传统权限管理更加细粒的管理。主要是通过以下三个方面进行控制权限:</p>
<ol>
<li>使用者(user)：针对使用者进行权限限制；</li>
<li>群组(group):针对群组进行权限限制；</li>
<li>预设属性(mask):设置目录下新建使用的默认权限。</li>
</ol>
<p>在目前linux常用的分区类型(ext2/ext3/ext4/xfs等)默认acl挂载。虽然分区一般默认支持acl，但是还是需要相应的工具才能完全使用，一般使用<code>setfacl</code>和<code>getfacl</code>，如果提示找不到命令，在CentOS系统中可以在root用户下使用命令<code>yum install acl</code>安装。</p>
<h3 id="开启分区ACL权限"><a href="#开启分区ACL权限" class="headerlink" title="开启分区ACL权限"></a>开启分区ACL权限</h3><h4 id="临时开启分区ACL权限"><a href="#临时开启分区ACL权限" class="headerlink" title="临时开启分区ACL权限"></a>临时开启分区ACL权限</h4><p>重新挂载根分区:</p>
<p><code>mount -o remount,rcl /</code></p>
<p>临时开启acl分区在重启系统之后恢复到初始状态。</p>
<h4 id="永久开启分区ACL权限"><a href="#永久开启分区ACL权限" class="headerlink" title="永久开启分区ACL权限"></a>永久开启分区ACL权限</h4><p>修改<code>/etc/fstab</code>文件，在默认参数中添加acl选项。</p>
<p><img src="/2019/11/17/linux用户及权限管理/img7.webp" alt="添加acl选项"></p>
<p>保存修改后，重载分区或者重启系统生效。</p>
<h3 id="ACL权限设置"><a href="#ACL权限设置" class="headerlink" title="ACL权限设置"></a>ACL权限设置</h3><p>一般使用<code>getfacl</code>和<code>setfacl</code>两个工具完成ACL权限设置。</p>
<h4 id="setfacl"><a href="#setfacl" class="headerlink" title="setfacl"></a>setfacl</h4><pre><code class="bash">setfacl [-bkndRLPvh] [{-m|-x} acl_spec] [{-M|-X} acl_file] file
# 参数与选项
# -m 从命令行输入ACL条目进行更改
# -M 从文件中读取ACL条目进行更改
# -x 从命令行输入移除ACL条目
# -X 从文件中读取ACL条目，并移除
# -b 移除所有文件和目录的拓展ACL权限，仅保留所有者、群组和其他人权限设置；
# -k 移除预设ACL权限；
# -n 不重计算有效掩码
# --mask 重计算有效掩码
# -d 所有操作应用到ACL中
# -R 应用到所有文件和路径
# -L 按照系统逻辑，跟随符号连接
# -P 按照自然逻辑，不跟随符号连接
# -v 版本信息
# -h help
# --resotre 恢复权限备份
# --test 测试模式，不修改任何权限
# -- 命令模式结束标志
# - 如果文件名称为‘-’，那么从标准输入读取文件列表。

# ACL权限条目
[d[efault]:] [u[ser]:]uid [:perms]
# 设置用户权限

[d[efault]:] g[roup]:gid [:perms]
# 设置群组权限

[d[efault]:] m[ask][:] [:perms]
# 设置掩码

[d[efault]:] o[ther][:] [:perms]
# 设置其他人权限</code></pre>
<h5 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h5><p>使用root创建test.txt文件，setfacl设置test的rw权限，代码如下：</p>
<p>root用户执行:</p>
<pre><code>touch test.txt
setfacl -mu:test:rw test.txt</code></pre><p><img src="/2019/11/17/linux用户及权限管理/img8.webp" alt="使用root用户创建文件，并且设置test用户的读写acl权限"></p>
<p>从上图中可以看出当设置了acl权限之后，权限部分最后变成了‘+’。</p>
<p><img src="/2019/11/17/linux用户及权限管理/img9.webp" alt="使用test账户测试，尝试写入以及读取test.txt文件"></p>
<p>设置<strong>群组、其他人</strong>的权限类似。</p>
<h4 id="getfacl"><a href="#getfacl" class="headerlink" title="getfacl"></a>getfacl</h4><p><code>getfacl</code>命令用于获取文件或则目录的acl权限信息。命令用法如下:</p>
<pre><code>getfacl path</code></pre><p><img src="/2019/11/17/linux用户及权限管理/img10.webp" alt="查看test.txt的acl信息"></p>
<h4 id="有效掩码"><a href="#有效掩码" class="headerlink" title="有效掩码"></a>有效掩码</h4><p>有效掩码设置方式<code>setfacl -mm:mask path</code>,有效掩码即在强制限制权限赋予范围，当赋予的权限不属于有效权限时则该权限无效。注意:<strong>默认在修改ACL权限时会重新计算有效掩码，可加入’-n’选项避免重新计算有效掩码</strong></p>
<p><img src="/2019/11/17/linux用户及权限管理/img11.webp" alt="有效掩码限制权限发放"></p>
<p>注意：权限只有所有者有权限修改(chmod)。而修改文件所有者(chown)只有root有权限修改。</p>
<h4 id="预设ACL权限"><a href="#预设ACL权限" class="headerlink" title="预设ACL权限"></a>预设ACL权限</h4><p>预设权限使得权限可以继承。如果一个目录设置了预设ACL权限，那么子目录下的权限都将继承预设权限。</p>
<h5 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h5><p>root用户创建一个test文件夹，给test用户设置该目录预设读取权限，root在该目录下创建test.txt文件，并写入’hello world!’内容。然后退出root用户使用test用户读取该文件内容。</p>
<p><img src="/2019/11/17/linux用户及权限管理/img12.webp" alt="目录中的文件继承了预设ACL权限"></p>
<h3 id="用户身份切换"><a href="#用户身份切换" class="headerlink" title="用户身份切换"></a>用户身份切换</h3><p>在linux系统使用过程中，有时会使用不同的用户，就会使用到用户切换命令。</p>
<h4 id="切换身份的原因"><a href="#切换身份的原因" class="headerlink" title="切换身份的原因"></a>切换身份的原因</h4><ol>
<li>日常使用系统，使用一般用户；为了系统的安全，使用一般用户进行日常作业，当需要设定系统环境时，切换到root用户，这样操作相对安全，避免一些严重的误操作，例如<code>rm -rf /</code>。</li>
<li>使用较低较少的权限启动系统服务；例如系统安装apache软件，使用单独的apache用户，即使程序被攻破，系统还不至于崩溃。</li>
<li>软件本身的限制。在早期的talnet，程序预设是不允许root登录的，talnet会判断登录者的UID，如果登录者的UID为0，直接拒绝登入。因此只能使用一般用户登录系统。</li>
</ol>
<h4 id="一般用户切换为root用户方法"><a href="#一般用户切换为root用户方法" class="headerlink" title="一般用户切换为root用户方法"></a>一般用户切换为root用户方法</h4><ol>
<li><code>su -</code>，这个指令能从一般用户切换到root用户，但是需要输入root用户的密码，就是一般用户需要知道root用户的密码。</li>
<li><code>sudo</code>指令执行root指令，sudo使用需要事先进行设置，sudo使用的是自身账户的密码。在多人同时管理同一台linux系统时，使用<code>sudo</code>更加合适，可以有效避免root用户泄露。</li>
</ol>
<h4 id="su"><a href="#su" class="headerlink" title="su"></a>su</h4><p><code>su</code>是最简单的身份切换指令，可以进行任何身份的切换。使用方法如下:</p>
<pre><code class="bash">su [-lm] [-c指令] [username]
# 选项和参数讲解
# - 表示是以与真实登录类似的方式切换用户，清除目前的变量，重设主目录、当前shell、当前用户、登录名称、PATH变量；设置当前路径为主目录。
# -l 和-类似，后面需要接欲切换的用户账号，也就是login-shell方式
# -m -m和-p是类似的，表示使用目前的环境设定，不读取新用户的设定。
# -c 进行一次指令执行，所以-c接上指令。
# 默认情况下，su为以nologin-shell方式登录，PATH等变量都不会改变。
# root用户切换到其他用户，不需要使用任何密码。</code></pre>
<h4 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h4><p>sudo使用方法如下:</p>
<pre><code class="bash">sudo [-b] [-u新使用账号]
# 选项和参数讲解
# -b 将后续的指令放到背景中执行    而不会与当前的shell产生联系。
# -u 后面接欲切换的用户，无指定则切换为root用户。</code></pre>
<p><strong>sudo执行流程</strong>：</p>
<ol>
<li>当使用sudo时，首先查询/etc/sudoers档案，查看该用户是否具有执行sudoers的权限；</li>
<li>当具有权限之后，让用户输入用户密码进行确认；</li>
<li>如果密码输入成功之后，便使用sudo执行后续指令（root使用sudo不需要输入密码）；</li>
<li>如果想切换的身份与执行者的身份相同时，不需要输入密码。</li>
</ol>
<h4 id="sudo设置"><a href="#sudo设置" class="headerlink" title="sudo设置"></a>sudo设置</h4><h5 id="visudo和-etc-sudoers"><a href="#visudo和-etc-sudoers" class="headerlink" title="visudo和/etc/sudoers"></a>visudo和/etc/sudoers</h5><p>是否具有sudo的权限是由/etc/sudoers文档决定的，所以要想给用户添加sudo权限就需要更改/etc/sudoers文件，由于文档有一定的语法并且设置错误会导致严重的错误，所以一般使用<code>visudo</code>进行设置。一般在退出设定时会检查文档的语法是否有错误。</p>
<p>visudo设置的方法有两种:</p>
<ol>
<li><p>对单一使用者设置sudo。<br>使用visudo命令打开sudo的配置文件：</p>
<pre><code class="bash"># 在root ALL=(ALL)ALL后一行添加如下内容:
test ALL=(ALL)ALL
# 参数讲解
# 例如已有的: root ALL=(ALL)ALL
# 用户名 登入者的来源主机名称=(可切换的身份)可下达的指令</code></pre>
</li>
<li><p>使用wheel群组和免密码功能处理visudo</p>
<p>使用visudo命令打开sudo的配置文件:</p>
<pre><code class="bash"># 将%wheel ALL=(ALL)ALL的注释去掉即可使wheel群组的用户都具有sudo权限,而新的用户只需添加到该群组就行.
# 去除密码的设置如: %wheel ALL=(ALL) NOPASSWD: ALL</code></pre>
</li>
</ol>
<p><em>注意:</em>在指定能下达指令时,要使用绝对路径,并且多个命令使用英文逗号<code>,</code>分开.</p>
<h5 id="有限制的指令操作"><a href="#有限制的指令操作" class="headerlink" title="有限制的指令操作"></a>有限制的指令操作</h5><p>比如赋予了sudo能执行passwd的权限,但是如果直接给passwd命令权限则可能将root用户的密码修改导致root用户不能登录,因此需要限制用户修改root用户的密码.具体设置如下:</p>
<pre><code class="bash">test ALL=(root) !/usr/bin/passwd,/usr/bin/passwd [a-zA-Z]*,!/usr/bin/passwd root
# !表示不能执行的指令,不能执行/usr/bin/passwd和/usr/bin/passwd root两个命令.</code></pre>
<h5 id="通过别名建置visudo"><a href="#通过别名建置visudo" class="headerlink" title="通过别名建置visudo"></a>通过别名建置visudo</h5><p>如果有15个用户需要添加到sudo权限中的话,除了使用用户组进行管理以外,还能通过别名建置获得sudo权限.假设需要将test1、test2、test3…test15一共15个用户添加到sudo中,并限制只能修改除root用户外用户的密码，除了使用用户组或者单个添加以外，还能使用如下设置：</p>
<pre><code class="bash">User_Alias TESTS=test1,test2,test3,test4,test5,test6,test7,test8,test9,test10,test11,test12,test13,test14,test15
Cmnd_Alias TESTSCMD=!/usr/bin/passwd,/usr/bin/passwd [a-zA-Z]*,!/usr/bin/passwd root
TESTS ALL=(root) TESTSCMD</code></pre>
<p>添加之后即可使用户具有修改密码权限。</p>
<h5 id="sudo时间间隔"><a href="#sudo时间间隔" class="headerlink" title="sudo时间间隔"></a>sudo时间间隔</h5><p>两条sudo命令连着使用都需要输入密码，可以设置使用时间间隔不超过5分钟，不需要重新输入用户密码。设置如下:</p>
<pre><code class="bash"># 将默认的Defaults env_reset改为设置（5分钟为超时时间）：
Defaults env_reset , timestamp_timeout=5</code></pre>
<h5 id="通过sudo将用户切换到root用户-非信任用户切勿使用"><a href="#通过sudo将用户切换到root用户-非信任用户切勿使用" class="headerlink" title="通过sudo将用户切换到root用户(非信任用户切勿使用)"></a>通过sudo将用户切换到root用户(非信任用户切勿使用)</h5><pre><code class="bash">User_Alias ADMINS=test1,test2
ADMINS ALL=(root) /bin/su -</code></pre>
<h2 id="特殊的SHELL"><a href="#特殊的SHELL" class="headerlink" title="特殊的SHELL"></a>特殊的SHELL</h2><p>在安装linxu系统之时，会默认创建许多许多系统用户，例如，负责管理邮箱的mail用户等等，mail用户只是用于使用相关的资源，而不是用于登录linux系统，因此设置mail用户的密码，同时设置mail用户登录使用的shell为/sbin/nologin，这个shell为无法登录的合法shell。输入正确的账号密码登录之后会提示:</p>
<pre><code class="bash">This account is currently not available.</code></pre>
<h2 id="PAM模组"><a href="#PAM模组" class="headerlink" title="PAM模组"></a>PAM模组</h2><p>在以前，如果需要对用户进行认证，需要专门的程序判断用户和密码是否正确，那么就存在在同一个主机上存在多个不同的认证系统，可能会造成账户和密码不同步的问题，从而引入了PAM(Pluggable  Authentication Modules,可插拔认证模块)机制。PAM是一整套应用程序接口(Application Program Interface,API),提供一连串验证机制。PAM可实现使用者将验证过程的需求告知PAM，PAM即可返回相应的验证的结果。PAM既是一套验证机制，也可以提供其他软件调用验证，让账户的验证具有一致性。</p>
<p><img src="/2019/11/17/linux用户及权限管理/img13.webp" alt="PAM验证结构"></p>
<p>在系统中PAM作为API存在，需要PAM认证的程序即可调用该接口，经过一系列验证之后将结果返回，程序可以根据验证的结果做出相应的反应。PAM进行验证的信息成为模块(Modules)，每个PAM模块的功能不同。</p>
<h3 id="PAM模块设定语法"><a href="#PAM模块设定语法" class="headerlink" title="PAM模块设定语法"></a>PAM模块设定语法</h3><p>PAM由一个和程序名相同的设定文档确定认证流程。当执行<code>passwd</code>后，PAM运行的流程为:</p>
<ol>
<li>使用者调用passwd，并输入密码；</li>
<li>passwd程序调用PAM进行认证；</li>
<li>PAM到/etc/pam.d/中找与程序(passwd)同名的设定档；</li>
<li>依据/etc/pam.d/passwd文档的设定，调用相应的PAM模块进行验证；</li>
<li>将验证结果返回passwd程序；</li>
<li>passwd根据返回的结果做出相应的反应。</li>
</ol>
<p>因此，PAM中最重要的是验证的模块和/etc/pam.d/目录下的设定文档。以passwd的设定档（/etc/pam.d/passwd）为例:</p>
<pre><code class="bash">#%PAM-1.0   # PAM版本说明
auth       include      system-auth     # 以后每一行都是一个验证的过程
account    include      system-auth
password   substack     system-auth
-password   optional    pam_gnome_keyring.so use_authtok
password   substack     postlogin</code></pre>
<p>每一行都是一个独立的验证流程，每一行都可以分为三个部分，分别是验证类别(type)、控制标识(flag)和PAM模块和该模块的参数。</p>
<h4 id="验证类别-type"><a href="#验证类别-type" class="headerlink" title="验证类别(type)"></a>验证类别(type)</h4><p>验证类别主要分为4种:</p>
<ul>
<li><strong>auth</strong>:authentication的缩写，通常用于验证使用者的身份验证，通常需要使用密码来验证，所以后续接的模块一般验证使用者身份的。</li>
<li><strong>account</strong>:account(账户)一般是用于authorization（授权），主要用于检验使用者是否具有正确的使用权限。</li>
<li><strong>session</strong>:session就是会话的意思，所以session管理的是使用者在此次登入（或这个指令）期间，PAM所给予的环境设定。session一般会记录使用者登入和登出时的信息。比如，使用su命令和sudo命令可以在/var/log/secure中找到很多关于pam的说明。记录的资料都是session open和session close等。</li>
<li><strong>passwd</strong>:这种类别主要提供验证的修订工作，比如修改/变更密码等。</li>
</ul>
<h4 id="控制标识（control-flag"><a href="#控制标识（control-flag" class="headerlink" title="控制标识（control flag)"></a>控制标识（control flag)</h4><p>控制标志是指验证的过程中通过的标准，控制验证的放行标准，一般分为4中控制标志:</p>
<ul>
<li><strong>required</strong>:如果验证成功则带success标志，验证失败则带failure标志，无论验证成功还是验证失败都会进行后续的验证流程。由于后续的流程可以继续进行，相当于有利于资料的登录（log),这也是经常使用required的原因。</li>
<li><strong>requisite</strong>：如果验证失败立刻返回原程序failure标志，并且终止后续的验证流程。如果验证成功则带success标志并继续后续验证流程。</li>
<li><strong>sufficient</strong>:如果验证成功则立刻回传success给原程序。并终止后续验证流程：如果验证失败则带failure标志并继续后续验证流程。</li>
<li><strong>optional</strong>：大多数用在显示讯息，不用于验证。</li>
</ul>
<p><img src="/2019/11/17/linux用户及权限管理/img14.webp" alt="控制标志的验证流程"></p>
<h4 id="常用的PAM模块"><a href="#常用的PAM模块" class="headerlink" title="常用的PAM模块"></a>常用的PAM模块</h4><p>经常我们需要通过各种方式登入系统，因此看一下登入所需的PAM流程，即/etc/pam.d/login文档中的内容:</p>
<pre><code class="bash">#%PAM-1.0
auth [user_unknown=ignore success=ok ignore=ignore default=bad] pam_securetty.so
auth       substack     system-auth
auth       include      postlogin
account    required     pam_nologin.so
account    include      system-auth
password   include      system-auth
# pam_selinux.so close should be the first session rule
session    required     pam_selinux.so close
session    required     pam_loginuid.so
session    optional     pam_console.so
# pam_selinux.so open should only be followed by sessions to be executed in the user context
session    required     pam_selinux.so open
session    required     pam_namespace.so
session    optional     pam_keyinit.so force revoke
session    include      system-auth
session    include      postlogin
-session   optional     pam_ck_connector.so</code></pre>
<p>在login文档中使用了很多次system-auth模块，此模块（/etc/pam.d/system-auth）的配置内容为：</p>
<pre><code class="bash">#%PAM-1.0
# This file is auto-generated.
# User changes will be destroyed the next time authconfig is run.
auth        required      pam_env.so
auth        required      pam_faildelay.so delay=2000000
auth        sufficient    pam_unix.so nullok try_first_pass
auth        requisite     pam_succeed_if.so uid &gt;= 1000 quiet_success
auth        required      pam_deny.so

account     required      pam_unix.so
account     sufficient    pam_localuser.so
account     sufficient    pam_succeed_if.so uid &lt; 1000 quiet
account     required      pam_permit.so

password    requisite     pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=
password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok
password    required      pam_deny.so

session     optional      pam_keyinit.so revoke
session     required      pam_limits.so
-session     optional      pam_systemd.so
session     [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid
session     required      pam_unix.so</code></pre>
<p>详细的模块的信息在linux中都可以找到，常见的模块:</p>
<ul>
<li>每个程序的个别PAM设定档:/etc/pam.d/*;</li>
<li>PAM模块实际放置位置:/lib64/security/*;</li>
<li>其他PAM环境设定文档:/etc/security/*;</li>
<li>详细的PAM说明文档:/usr/share/doc/pam-*;</li>
</ul>
<p>这里列举几个常用的PAM模块：</p>
<ul>
<li><strong>pam_securetty.so</strong>:限制root用户只能从安全终端登录，而常见的安全的终端就是TTY1,TTY2等终端机装置名称。而安全的终端机设定是由/etc/securetty文档决定的。</li>
<li><strong>pam_nologin.so</strong>:限制一般使用者能否登入主机，当/etc/nologin这个文档存在时，则所有一般用户都不能登入系统，并且将其中的内容输出到登录的终端上。在正常的系统中不存在，但是该模块不能限制root及已经登录的用户。</li>
<li><strong>pam_selinux.so</strong>:SELinux是针对程序进行细部权限管理的功能，由于SELinux会影响到使用者执行程序的权限，因此我们利用PAM模块，暂时将SELinux暂时关闭，验证通过后再打开。</li>
<li><strong>pam_console.so</strong>:当系统出现问题或者需要通过特殊终端登陆系统时，该模块可以处理一些档案的权限问题，让使用者可以通过特殊终端登入系统。</li>
<li><strong>pam_loginuid.so</strong>:通过用户UID，验证一般账号和系统账号。</li>
<li><strong>pam_env.so</strong>:用于设定环境变量的模块，如果你有需要额外的环境变量设定，可以参考/etc/security/pam_env.conf这个档案。</li>
<li><strong>pam_unix.so</strong>：该模组很复杂也很重要，该模组可以用于验证阶段的认证功能，可以用在授权阶段的用户授权管理，也可以用在会话阶段的登录档记录，甚至可以用在密码更新阶段的检验。</li>
<li><strong>pam_pwquanlity.so</strong>：该模块用于检验密码强度。包括密码是否存在于字典中，密码输入几次失败就断掉此次连线的功能，都可以由该模块提供的。最早之前使用的是pam_cracklib.so这个模组，后改为pam_pwquanlity.so模组。但是该模组完全兼容于之前的pam_cracklib.so模组。</li>
<li><strong>pam_limits.so</strong>:提供ulimit功能，设定档参考/etc/security/limits.conf。</li>
</ul>
<h5 id="limits-conf"><a href="#limits-conf" class="headerlink" title="limits.conf"></a>limits.conf</h5><p>limits.conf这个文件对用户使用的资源进行限制。一般账号资源限制格式如下:</p>
<pre><code class="bash">test soft fsize 1000
test hard fsize 9000</code></pre>
<p>账号限制栏分为4栏，第一栏为账号，如果是群组限制则在群组名称前加@符号；</p>
<p>第二栏为对限制的要求，soft为警告，hard为严格。</p>
<p>第三栏为限制的内容，这里使用的限制档案的容量。</p>
<p>第四栏为限制的值，这里使用的单位为KB。</p>
<p>限制test用户登录的最大连接数为1，设置为:</p>
<pre><code class="bash">test hard maxlogins 1</code></pre>
<p>因为PAM只用在验证的时候才使用，对于已经登入的用户没有作用。所以修改过的资料需要用户重新登入才能使设置生效。</p>
<h2 id="使用者的信息传递"><a href="#使用者的信息传递" class="headerlink" title="使用者的信息传递"></a>使用者的信息传递</h2><p>使用同一台电脑的不同用户之间的沟通，查看不同用户的信息。</p>
<h3 id="查询使用者，w，who，last，lastlog"><a href="#查询使用者，w，who，last，lastlog" class="headerlink" title="查询使用者，w，who，last，lastlog"></a>查询使用者，w，who，last，lastlog</h3><p>通过<code>w</code>或者<code>who</code>命令就可以查询到目前在线的用户。</p>
<p>想要查询到最近用户的登录的时间，可以使用<code>lastlog</code>命令，该指令是去读去/var/log/lastlog文档。</p>
<h3 id="使用者之间交流，write，mesg，wall"><a href="#使用者之间交流，write，mesg，wall" class="headerlink" title="使用者之间交流，write，mesg，wall"></a>使用者之间交流，write，mesg，wall</h3><p>利用<code>write</code>指令可以直接将信息传递给接受者。命令格式如下:</p>
<pre><code class="bash">write 用户名称 [用户所使用的终端]</code></pre>
<p>当在该指令中输入消息，回车之后会立马将该消息传递给指定用户，如果用户在做其他任务，突然出现的消息会将工作打乱，因此可以通过<code>mesg n</code>命令选择不接收消息。即使选择不接收消息，但是对于root用户的消息不受该选项的影响，会直接传递给用户。</p>
<p>广播则使用<code>wall</code>指令，命令使用的方法:</p>
<pre><code class="bash">wall &#39;消息内容&#39;</code></pre>
<h3 id="使用者的邮箱"><a href="#使用者的邮箱" class="headerlink" title="使用者的邮箱"></a>使用者的邮箱</h3><p>使用write、wall命令都需要用户在线才能接收到消息，除此以外还能通过mail传递信息到用户。使用<code>mail -s &quot;邮件标题&quot; username@localhost</code>命令即可开始编写邮件并发送邮件，编辑完邮件之后使用单独一行<code>.</code>表示邮件内容的结束。</p>
<p>mail常使用的命令:</p>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">h</td>
<td align="center">列出信件标头；如果要查阅40 封信件左右的信件标头，可以输入<code>h 40</code></td>
</tr>
<tr>
<td align="center">d</td>
<td align="center">删除后续接的信件号码，删除单封是<code>d10</code>，删除20~40 封则为<code>d20-40</code>。不过，这个动作要生效的话，必须要配合q 这个指令才行(参考底下说明)！</td>
</tr>
<tr>
<td align="center">s</td>
<td align="center">将信件储存成档案。例如我要将第5 封信件的内容存成~/mail.file:<code>s 5 ~/mail.file</code></td>
</tr>
<tr>
<td align="center">x</td>
<td align="center">或者输入exit 都可以。这个是’不作任何动作离开mail 程式’的意思。不论你刚刚删除了什么信件，或者读过什么，使用exit 都会直接离开mail，所以刚刚进行的删除与阅读工作都会无效。如果您只是查阅一下邮件而已的话，一般来说，建议使用这个离开啦！除非你真的要删除某些信件。</td>
</tr>
<tr>
<td align="center">q</td>
<td align="center">相对于exit 是不动作离开， q 则会实际进行你刚刚所执行的任何动作(尤其是删除！)</td>
</tr>
</tbody></table>
<h2 id="Centos下建立大量账号"><a href="#Centos下建立大量账号" class="headerlink" title="Centos下建立大量账号"></a>Centos下建立大量账号</h2><p>在Linux下创建大量的用户，需要检查用户创建是否存在问题，那么这个时候就需要使用工具进行辅助设置。</p>
<h3 id="一些用户相关的检查工具"><a href="#一些用户相关的检查工具" class="headerlink" title="一些用户相关的检查工具"></a>一些用户相关的检查工具</h3><h4 id="pwck"><a href="#pwck" class="headerlink" title="pwck"></a>pwck</h4><p>这个指令用于检查/etc/passwd文档中用户的设定信息，以及家目录实际存在等等信息。甚至还可以比对/etc/passwd、/etc/shadow中的信息是否一致，如果存在问题，则提示修改。</p>
<p><img src="/2019/11/17/linux用户及权限管理/img15.webp" alt="pwck指令检查结果"></p>
<p>以上为pwck检查结果，检查结果为系统用户存在部分错误，这些错误属于正常的错误，不用解决。对应的群组检查命令使用<code>grpck</code>命令。</p>
<h4 id="pwconv"><a href="#pwconv" class="headerlink" title="pwconv"></a>pwconv</h4><p>这个命令主要用于将/etc/passwd中的密码信息移动到/etc/shadow中，一般用在较旧的系统上，为了安全考虑，将密码从/etc/passwd中转移到/etc/shadow中。</p>
<h4 id="pwunconv"><a href="#pwunconv" class="headerlink" title="pwunconv"></a>pwunconv</h4><p>这个命令恰好相反，将/etc/shadow中的密码写回到/etc/passwd中，并且删除/etc/shadow档案。</p>
<h4 id="chpasswd"><a href="#chpasswd" class="headerlink" title="chpasswd"></a>chpasswd</h4><p>这个命令可以读入未加密的密码，并把这个密码写入到/etc/shadow中去，这个命令常常使用在大量建构用户的工作中去。读入资料的格式为”用户名:密码”。例如:</p>
<pre><code class="bash">echo &#39;test:123456&#39; | chpasswd</code></pre>
<h3 id="大量建置用户的办法-passwd-–stdin"><a href="#大量建置用户的办法-passwd-–stdin" class="headerlink" title="大量建置用户的办法(passwd –stdin)"></a>大量建置用户的办法(passwd –stdin)</h3><p>可以通过脚本使用<code>passwd --stdin</code>大量建置用户</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><blockquote>
<p>伪用户资料:<a href="https://blog.csdn.net/Add_a_cat/article/details/97614942" target="_blank" rel="noopener">https://blog.csdn.net/Add_a_cat/article/details/97614942</a></p>
<p>开启分区ACL权限:<a href="https://www.cnblogs.com/ysocean/p/7801329.html" target="_blank" rel="noopener">https://www.cnblogs.com/ysocean/p/7801329.html</a></p>
<p>setfacl参数详解:<a href="https://www.cnblogs.com/ftl1012/p/setfacl.html" target="_blank" rel="noopener">https://www.cnblogs.com/ftl1012/p/setfacl.html</a></p>
</blockquote>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 qinzhtao@163.com </span>
    </div>
</article>


<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>linux用户及权限管理</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">9.4k</span></p>
    <p><span class="copy-title">本文作者:</span><a href="javascript:void(0)" title="捌叁壹伍">捌叁壹伍</a></p>
    <p><span class="copy-title">发布时间:</span>2019-11-17, 11:58:41</p>
    <p><span class="copy-title">最后更新:</span>2019-12-18, 14:11:07</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2019/11/17/linux用户及权限管理/" title="linux用户及权限管理">http://qzt8315.github.io/2019/11/17/linux用户及权限管理/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="/js/md5.js"></script>

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '150300db6044cbdbef06',
            clientSecret: '3a9c198e82036ef02678373645b09c0910f42846',
            repo: 'qzt8315.github.io',
            owner: 'qzt8315',
            admin: ['qzt8315'],
            // id: location.pathname,
            id: hex_md5(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<input type="hidden" id="MathJax-js" value="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">

    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2016-2019 qzt</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
<script src="//cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>

<script src="/js/script.js?v=1"></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#教程','#博客','#hexo','#新手','#公式编辑','#linux','#awk','#备份','#设置','#网卡','#bond','#用户','#markdown','#标签','#语法','#入门','#quota','#raid','#lvm','#shell-script','#判断式','#PC','#维护','#命令','#数学公式','#观影','#动漫','#H5','#易企秀','#diff','#cmp','#patch','#正则表达式','#深度学习','#概念','#秀米','#图文排版','#网络','#基础概念','#shell_script','#西瓜书','#符号表','#读书','#第一章','#第三章','#第二章','#第四章',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    
    .post .pjax article blockquote {
        padding: 10px 20px;
        background-color: white;
        border: none;
        border-left: 4px solid #42b983;
        border-right: 4px solid #42b983;
        border-radius: 10px;
    }
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.1;
        background: url("http://img.xiangzhangshugongyi.com/FlSExUGfRSaqxkK5v42CpuI-tXAL.jpg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
